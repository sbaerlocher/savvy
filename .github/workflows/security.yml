---
name: Security Scan

"on":
  schedule:
    - cron: "0 2 * * 1" # Weekly Monday 02:00 UTC
  workflow_dispatch:

permissions:
  contents: read
  security-events: write
  pull-requests: write

jobs:
  code-analysis:
    name: SAST (CodeQL)
    uses: sbaerlocher/.github/.github/workflows/security-code.yml@main
    with:
      languages: '["go"]'

  dependency-scan:
    name: Dependencies & Licenses
    uses: sbaerlocher/.github/.github/workflows/security-deps.yml@main
    with:
      language: 'go'
      enable-license-check: true

  secret-detection:
    name: Secret Detection
    uses: sbaerlocher/.github/.github/workflows/security-secrets.yml@main

  container-scan:
    name: Container Security
    uses: sbaerlocher/.github/.github/workflows/security-containers.yml@main
    with:
      image-ref: 'ghcr.io/${{ github.repository }}:latest'
      scan-type: 'registry'
