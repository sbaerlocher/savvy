---
name: Continuous Integration

"on":
  pull_request:
    branches: [main]
  workflow_call:
  schedule:
    - cron: "0 6 * * 1" # Weekly security scans (Mondays 6 AM UTC)

permissions:
  contents: read
  security-events: write
  pull-requests: write

jobs:
  ci:
    name: Go CI Pipeline
    uses: sbaerlocher/.github/.github/workflows/ci-go.yml@main
    with:
      go-version: '1.25'
      enable-postgres: true
      postgres-db: 'savvy_test'
      postgres-user: 'savvy'
      postgres-password: 'test_password'
      pre-build-commands: |
        go install github.com/a-h/templ/cmd/templ@latest
        templ generate
      test-env-vars: '{"SESSION_SECRET": "test-secret-key-for-ci", "GO_ENV": "test"}'
      enable-codecov: true
      enable-codeql: true
      enable-security-scans: true
      enable-dependency-review: true
      enable-sarif-upload: false
      binary-path: './cmd/server'
    secrets:
      CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
