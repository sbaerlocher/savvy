# Bitwarden Secrets Manager Example
# Usage: helm install savvy ./helm/savvy -f values-examples/bitwarden.yaml
#
# Prerequisites:
# 1. Create secrets in Bitwarden Secrets Manager:
#    - savvy-database-url         → postgres://user:pass@host:5432/db?sslmode=require
#    - savvy-session-secret       → random-secret-string
#    - savvy-oauth-client-id      → oauth-client-id (optional)
#    - savvy-oauth-client-secret  → oauth-client-secret (optional)
#
# 2. Configure ClusterSecretStore with Bitwarden provider

externalSecrets:
  enabled: true
  refreshInterval: 1h
  secretStoreRef:
    name: bitwarden-secret-store
    kind: ClusterSecretStore

  secrets:
    # Session Secret
    - target:
        name: savvy-session
        key: SESSION_SECRET
      remoteRef:
        key: "savvy-session-secret"

    # Database URL (complete connection string)
    - target:
        name: savvy-db
        key: uri
      remoteRef:
        key: "savvy-database-url"

    # OAuth Secrets (optional)
    - target:
        name: savvy-oauth
        key: client-id
      remoteRef:
        key: "savvy-oauth-client-id"
    - target:
        name: savvy-oauth
        key: client-secret
      remoteRef:
        key: "savvy-oauth-client-secret"

# Database Configuration
database:
  existingSecret: "savvy-db"
  databaseUrlKey: "uri"

# OAuth Configuration (optional)
oauth:
  enabled: false
  issuer: "https://auth.example.com"
  redirectUrl: "https://savvy.example.com/auth/oauth/callback"
  existingSecret: "savvy-oauth"
